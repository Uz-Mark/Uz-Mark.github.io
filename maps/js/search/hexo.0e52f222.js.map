{"version":3,"file":"../../../js/search/hexo.0e52f222.js","names":["SearchService","fn","queryText","data","template","init","div","document","createElement","innerHTML","body","append","querySelectorAll","forEach","e","addEventListener","onSubmit","querySelector","close","event","preventDefault","input","target","value","search","async","style","display","fetchData","results","buildResultList","pages","posts","window","pjax","refresh","f","code","removeEventListener","fetch","SearchServiceDataPath","then","response","text","res","JSON","parse","html","post","replace","title","trim","slice","contentSearch","buildResult","permalink","digest","post_title","toLowerCase","post_content","keywords","split","foundMatch","index_title","index_content","first_occur","word","index","indexOf","start","end","Math","max","min","length","match_content","substring","keyword","regS","RegExp","url","getUrlRelativePath","arrUrl","relUrl","setQueryText","Object","freeze"],"sources":["js/search/hexo.0e52f222.js"],"mappings":"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","sourcesContent":["let SearchService = (() => {\n  fn = {};\n  fn.queryText = null;\n  fn.data = null;\n  fn.template = `<div id=\"u-search\">\n  <div class=\"modal\">\n    <header class=\"modal-header\" class=\"clearfix\">\n      <form id=\"u-search-modal-form\" class=\"u-search-form\" name=\"uSearchModalForm\">\n        <input type=\"text\" id=\"u-search-modal-input\" class=\"u-search-input\" />\n        <button type=\"submit\" id=\"u-search-modal-btn-submit\" class=\"u-search-btn-submit\">\n          <span class=\"fa-solid fa-search\"></span>\n        </button>\n      </form>\n      <a id=\"u-search-btn-close\" class=\"btn-close\"> <span class=\"fa-solid fa-times\"></span> </a>\n    </header>\n    <main class=\"modal-body\">\n      <ul class=\"modal-results\"></ul>\n    </main>\n  </div>\n  <div id=\"modal-overlay\" class=\"modal-overlay\"></div>\n</div>\n`;\n  fn.init = () => {\n    let div = document.createElement(\"div\");\n    div.innerHTML += fn.template;\n    document.body.append(div);\n    document.querySelectorAll(\".u-search-form\").forEach((e) => {\n      e.addEventListener(\"submit\", fn.onSubmit, false);\n    });\n    let uSearchModalInput = document.querySelector(\"#u-search-modal-input\");\n    uSearchModalInput.addEventListener(\"input\", fn.onSubmit);\n    document\n      .querySelector(\"#u-search-btn-close\")\n      .addEventListener(\"click\", fn.close, false);\n    document\n      .querySelector(\"#modal-overlay\")\n      .addEventListener(\"click\", fn.close, false);\n  };\n  fn.onSubmit = (event) => {\n    event.preventDefault();\n    let input = event.target.querySelector(\".u-search-input\");\n    if (input) {\n      fn.queryText = input.value;\n    } else {\n      fn.queryText = event.target.value;\n    }\n\n    if (fn.queryText) {\n      fn.search();\n    }\n  };\n  fn.search = async () => {\n    document.querySelectorAll(\".u-search-input\").forEach((e) => {\n      e.value = fn.queryText;\n    });\n    document.querySelector(\"#u-search\").style.display = \"block\";\n    if (!fn.data) {\n      fn.data = await fn.fetchData();\n    }\n    let results = \"\";\n    results += fn.buildResultList(data.pages);\n    results += fn.buildResultList(data.posts);\n    document.querySelector(\"#u-search .modal-results\").innerHTML = results;\n    window.pjax && pjax.refresh(document.querySelector(\"#u-search\"));\n    document.addEventListener(\"keydown\", function f(event) {\n      if (event.code === \"Escape\") {\n        fn.close();\n        document.removeEventListener(\"keydown\", f);\n      }\n    });\n  };\n  fn.close = () => {\n    document.querySelector(\"#u-search\").style.display = \"none\";\n  };\n  fn.fetchData = () => {\n    return fetch(SearchServiceDataPath)\n      .then((response) => response.text())\n      .then((res) => {\n        data = JSON.parse(res);\n        // console.log(data);\n        return data;\n      });\n  };\n  fn.buildResultList = (data) => {\n    let html = \"\";\n    data.forEach((post) => {\n      if (post.text) {\n        post.text = post.text.replace(/12345\\d*/g, \"\") // 简易移除代码行号\n      }\n      if (!post.title&&post.text) {\n        post.title = post.text.trim().slice(0,15)\n      }\n      if (fn.contentSearch(post)) {\n        html += fn.buildResult(post.permalink, post.title, post.digest);\n      }\n    });\n    return html;\n  };\n  fn.contentSearch = (post) => {\n    let post_title = post.title.trim().toLowerCase();\n    let post_content = post.text.trim().toLowerCase();\n    let keywords = fn.queryText\n      .trim()\n      .toLowerCase()\n      .split(/[-\\s]+/);\n    let foundMatch = false;\n    let index_title = -1;\n    let index_content = -1;\n    let first_occur = -1;\n    if (post_title && post_content) {\n      keywords.forEach((word, index) => {\n        index_title = post_title.indexOf(word);\n        index_content = post_content.indexOf(word);\n        if (index_title < 0 && index_content < 0) {\n          foundMatch = false;\n        } else {\n          foundMatch = true;\n          if (index_content < 0) {\n            index_content = 0;\n          }\n          if (index === 0) {\n            first_occur = index_content;\n          }\n        }\n        if (foundMatch) {\n          post_content = post.text.trim();\n          let start = 0;\n          let end = 0;\n          if (first_occur >= 0) {\n            start = Math.max(first_occur - 40, 0);\n            end =\n              start === 0\n                ? Math.min(200, post_content.length)\n                : Math.min(first_occur + 120, post_content.length);\n            let match_content = post_content.substring(start, end);\n            keywords.forEach(function (keyword) {\n              let regS = new RegExp(keyword, \"gi\");\n              match_content = match_content.replace(\n                regS,\n                \"<b mark>\" + keyword + \"</b>\"\n              );\n            });\n            post.digest = match_content + \"......\";\n          } else {\n            end = Math.min(200, post_content.length);\n            post.digest = post_content.trim().substring(0, end);\n          }\n        }\n      });\n    }\n    return foundMatch;\n  };\n  fn.buildResult = (url, title, digest) => {\n    let result = fn.getUrlRelativePath(url);\n    let html = \"\";\n    html += \"<li>\";\n    html +=\n      \"<a class='result' href='\" + result + \"?keyword=\" + fn.queryText + \"'>\";\n    html += \"<span class='title'>\" + title + \"</span>\";\n    if (digest !== \"\") html += \"<span class='digest'>\" + digest + \"</span>\";\n    html += \"</a>\";\n    html += \"</li>\";\n    return html;\n  };\n  fn.getUrlRelativePath = function (url) {\n    let arrUrl = url.split(\"//\");\n    let start = arrUrl[1].indexOf(\"/\");\n    let relUrl = arrUrl[1].substring(start);\n    if (relUrl.indexOf(\"?\") != -1) {\n      relUrl = relUrl.split(\"?\")[0];\n    }\n    return relUrl;\n  };\n  return {\n    init: () => {\n      fn.init();\n    },\n    setQueryText: (queryText) => {\n      fn.queryText = queryText;\n    },\n    search: () => {\n      fn.search();\n    },\n  };\n})();\nObject.freeze(SearchService);\n\nSearchService.init();\ndocument.addEventListener(\"pjax:success\", SearchService.init);\ndocument.addEventListener(\"pjax:send\", function () {\n  document.querySelector(\"#u-search\").style.display = \"none\";\n});\n"]}